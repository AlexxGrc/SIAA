@*Paginación*@
<script src="~/Scripts/jquery-3.2.1.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () { // Submit pageSizeForm when another pageSize value is selected
        $("#pageSize").change(function () {
            $("#pageSizeForm").submit();
        });
    });
</script>
@model PagedList.IPagedList<SIAAPI.Models.Comercial.Caracteristica>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@*Paginación*@


@*@model SIAAPI.Models.Comercial.Caracteristica*@

@{
    ViewBag.Title = "ConsultaRodillo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



@if (ViewBag.Articulo != null)
{
    <h3> Articulo que se esta cotizando</h3>
    SIAAPI.Models.Comercial.Articulo arti = (SIAAPI.Models.Comercial.Articulo)ViewBag.Articulo;
    <h3 class="text-danger">@arti.Cref</h3>
    <h3 class="text-info">@arti.Descripcion</h3>

}

@if (ViewBag.Caracteristica != null)
{


    SIAAPI.Models.Comercial.Caracteristica caraarti = (SIAAPI.Models.Comercial.Caracteristica)ViewBag.Caracteristica;

    <tach2>Presentacion @caraarti.IDPresentacion</tach2>
    <table>
        @try
        {

            string[] atributoss = caraarti.Presentacion.Split(',');
            <tr>
                @foreach (var atri in atributoss)
                {
                    string[] valor = atri.Split((char)58);
                    string Atri = valor[0];
                    string Val = valor[1];
                    <td style="background-color:burlywood" class="col-md-1">
                        <label style="color:white;">@Atri</label>
                    </td>
                }
            </tr>
            <tr>
                @foreach (var atri in atributoss)
                {
                    string[] valor = atri.Split((char)58);
                    string Atri = valor[0];
                    string Val = valor[1];
                    <td class="col-md-1">
                        <label>@Val</label>
                    </td>
                }
            </tr>


        }
        catch (Exception err)
        {
        }
    </table>




}




<h2>Consulta Rodillos</h2>

<p>

</p>
@*Busqueda*@
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <form class="navbar-form navbar-left">
            <div class="form-group">
                @using (Html.BeginForm())
                {
                    <p>
                        @*@Html.ActionLink("Crea un nuevo registro", "Create", null, new { @class = "btn btn-warning btn-xs" }) |*@
                        <div>
                            Elementos por página: @Html.DropDownList("pageSize") |

                            @*Filtro: @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, new { @placeholder = " Introduce el texto a buscar:" })*@

                            @*<a class="btn btn-info btn-xs" href="@Url.Action("Reporte")">Descargar Catalogo</a>*@

                            CLAVE: @Html.TextBox("clave", ViewBag.eje as string, new { type = "text" })
                            @*MATERIAL:   @Html.DropDownList("material")*@
                            FAMILIA:   @Html.DropDownList("familia")
                            <br />
                            | EJE MÁQUINA: @Html.TextBox("eje", ViewBag.ejemaquina as string, new { type = "text" })
                            | MAQUINA:  @Html.TextBox("maquina", ViewBag.avance as string, new { type = "text" })
                            | NO. DIENTES:   @Html.TextBox("diente", ViewBag.clave as string, new { step = "any", type = "number" }) |

                            <input type="submit" value="Aplicar" class="btn btn-primary btn-xs" /><span class="sr-only">(current)</span>
                        </div>
                        <a class="btn btn-info btn-xs" href="@Url.Action("ExcelRodillos")">Exportar a Excel</a>
                    </p>
                }

            </div>
        </form>
    </div>
</nav>
<br>
@*Busqueda*@

<table class="table">
    <tr>
        <th>
            @Html.Label("CLAVE")
        </th>
        <th>
            @Html.Label("NÚMERO DE DIENTES")
        </th>
        <th>
            @Html.Label("Eje MÁQUINA")
        </th>
        <th>
            @Html.Label("MÁQUINA")
        </th>

        <th>
            @Html.Label("EXISTENCIA")
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        FormulaSiaapi.Formulas FORMULA = new FormulaSiaapi.Formulas();
        FORMULA.cadenadepresentacion = item.Presentacion;

        string eje = "";
        double diente = 0;
        string maquina = "";
        

        try
        {
            eje = FORMULA.getValorCadena("Eje maquina", item.Presentacion);


        }
        catch
        {

        }
        try
        {

            diente = FORMULA.getvalor("Numero de Dientes", item.Presentacion);

        }
        catch
        {

        }
       
        try
        {
            maquina = FORMULA.getValorCadena("Maquina", item.Presentacion);


        }
        catch
        {

        }
        
        <tr>
            <td>
                @{
                    SIAAPI.Models.Comercial.ArticuloContext db = new SIAAPI.Models.Comercial.ArticuloContext();
                    string cadenacref = "select CREF  as dato from Articulo where idarticulo=" + item.Articulo_IDArticulo;

                    SIAAPI.Models.Comercial.ClsDatoString CLAVE = db.Database.SqlQuery<SIAAPI.Models.Comercial.ClsDatoString>(cadenacref).ToList().FirstOrDefault();

                }
                @Html.DisplayFor(modelItem => CLAVE.Dato)
            </td>
            <td>
                @Html.DisplayFor(modelItem => diente)
            </td>
            <td>
                @Html.DisplayFor(modelItem => eje)
            </td>

            <td>
                @Html.DisplayFor(modelItem => maquina)
            </td>
           
            <td>
                @{

                    string cadena = "select * from   VInventarioAlmacen where IDcaracteristica=" + item.ID;
                    List<SIAAPI.Models.Comercial.VInventarioAlmacen> Inventario = db.Database.SqlQuery<SIAAPI.Models.Comercial.VInventarioAlmacen>(cadena).ToList();
                    <table>
                            @foreach (SIAAPI.Models.Comercial.VInventarioAlmacen inventar in Inventario)
                            {

                        <tr>
                            <td>
                                @inventar.Almacen
                            </td>
                            <td >
                                @{int entero = (int)inventar.Existencia;
                                }
                               <div style="margin-left:20px; color:InfoText" >@entero</div> 
                            </td>
                           
                           
                        </tr>
                            }
                    </table>
                }
              
            </td>

        </tr>
    }

</table>
@*Paginación*@
@using (Html.BeginForm("ConsultaRodillo", "Articulos", FormMethod.Get, new { id = "pageSizeForm" }))
{
    <div class="pager">
        Página @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) de @Model.PageCount<br />

        @Model.Count de @Model.TotalItemCount elementos

        @Html.PagedListPager(Model, page => Url.Action("ConsultaRodillo", new
   {
       page,
       sortOrder = ViewBag.CurrentSort,
       currentFilter = ViewBag.CurrentFilter,
       searchString = ViewBag.searchString,

       eje = ViewBag.ejeseleccionada,
       avance = ViewBag.avanceseleccionada,
       clave = ViewBag.claveseleccionada,
       th = ViewBag.thseleccionada,
       material = ViewBag.materialseleccionado,
       familia = ViewBag.familiaseleccionada,
       pageSize = ViewBag.psize
   }))


    </div>
}


<script src="~/Scripts/libs/salert/sweetalert.min.js"></script>
<script>

        $(function(){
            $("#familia").on("change", function() {
             @ViewBag.familiaseleccionada=  $('[id$=familia] option:selected').text();

            });
        });
    $(function(){
        $("#material").on("change", function() {
         @ViewBag.materialseleccionado=  $('[id$=material] option:selected').text();

        });
    });
     $(function(){
        $("#th").on("change", function() {
         @ViewBag.thseleccionada=  $('[id$=th] option:selected').text();

        });
     });
     $(function(){
        $("#clave").on("change", function() {
         @ViewBag.claveseleccionada=  $('[id$=clave] option:selected').text();

        });
     });
     $(function(){
        $("#eje").on("change", function() {
         @ViewBag.ejeseleccionada=  $('[id$=eje] option:selected').text();

        });
     });
     $(function(){
        $("#avance").on("change", function() {
         @ViewBag.avanceseleccionada=  $('[id$=avance] option:selected').text();

        });
    });
</script>

@*Paginación*@