@*Paginación*@
@*<script src="~/Scripts/jquery-3.2.1.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () { // Submit pageSizeForm when another pageSize value is selected
            $("#pageSize").change(function () {
                $("#pageSizeForm").submit();
            });
        });
        });
    </script>*@
@model PagedList.IPagedList<SIAAPI.ViewModels.Articulo.VPArticulo>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@*Paginación*@

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<nav class="navbar navbar-default">
    <div class="container-fluid">
     
            <div class="form-group">
                @{
                    <div class="col col-md-6 col-sm-1">
                                        <div class="form-group">
                                            <div>
                                                <table>
                                                                    <tr>
                                                                        <td>  <h3>Artículos</h3> </td>
                                                                        <td>
                                                                            <form method="post" action='@Url.Action("DescargarPDFH", "FilePDF", new { ruta = "~/Manual/", name = "SiaapiArticulos.pdf" })' target="_blank">
                                                                                <button class="btn btn-warning btn-xs"><i class="fa fa-question-circle-o fa-lg"></i></button>
                                                                            </form>
                                                                        </td>

                                                                    </tr>
                                                </table>
                                            </div>
                                           
                                           
                                        </div>
                    </div>
                }

            </div>
     
    </div>
</nav>
<br>


@*Busqueda*@
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <form class="navbar-form navbar-left">
            <div class="form-group">
                @using (Html.BeginForm())
                {
                    <div>
                        <table>
                            <tr>
                                @if (@Roles.IsUserInRole("Administrador") || @Roles.IsUserInRole("Sistemas") || @Roles.IsUserInRole("Ventas") || @Roles.IsUserInRole("GerenteVentas") || @Roles.IsUserInRole("Compras") || @Roles.IsUserInRole("Facturacion") || @Roles.IsUserInRole("Produccion") || @Roles.IsUserInRole("AdminProduccion") || @Roles.IsUserInRole("Gerencia"))
                                {
                                    <th>
                                    <td>@Html.ActionLink("Crea un nuevo Articulo", "AgregaArticuloIsrael", "Articulos", null, new { @class = "btn btn-primary navbar-btn btn-xs" }) | </td>

                                    </th>
                                }
                                <td> Elementos por página: @Html.DropDownList("pageSize") | </td>
                                <td>Familia:  @Html.DropDownList("Familia", (IEnumerable<SelectListItem>)ViewBag.Familias, null, htmlAttributes: new { @class = "form-control", @id = "Familia", @onchange = "Cambiafamilia(this)" })</td>
                            </tr>
                        </table>
                    </div>
                    @* <button type="button" name="button" class="btn btn-warning btn-xs" onclick=Vermodal()>Crea un nuevo Articulo</button>|*@

                    <div>Escribe parte del Articulo o de la referencia : @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, new { @placeholder = " Introduce el texto a buscar:" }) | <input type="submit" value="Aplicar" class="btn btn-primary navbar-btn btn-xs" /><span class="sr-only">(current)</span></div>


                    <p>
                        <a class="btn btn-info btn-xs" href="@Url.Action("RArticulo")">Excel</a>
                       
                    </p>
                }

            </div>
        </form>
    </div>
</nav>
<br>

@*Busqueda*@

<table class="table">
    <tr>
        <th></th>
        <th>
            @Html.ActionLink("Clave", "Index", new { sortOrder = ViewBag.BSortParm, currentFilter = ViewBag.CurrentFilter })

        </th>
        <th>
            @Html.ActionLink("Descripción del producto", "Index", new { sortOrder = ViewBag.ASortParm, currentFilter = ViewBag.CurrentFilter })
        </th>
        <th>@Html.Label("Precio Unitario")</th>
        <th>@Html.Label("Moneda")</th>
        <th>@Html.Label("Unidad de Medida")</th>
        <th>
            @Html.ActionLink("Familia", "Index", new { sortOrder = ViewBag.CSortParm, currentFilter = ViewBag.CurrentFilter })
        </th>
        <th>@Html.Label("Tipo de Articulo")</th>
        <th></th>

        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>

            <td>
                <a href="~/imagenes/Upload/@item.nameFoto" download="~/imagenes/Upload/@item.nameFoto" class="w3-hover-opacity"><img  src="~/imagenes/Upload/@item.nameFoto" width="70" height="70"></a>
                @*<img src="~/imagenes/Upload/@item.nameFoto" alt="" width="70" height="70">*@

            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Cref)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Descripcion)
            </td>
            <td>
                <h3 class="text-success" style="text-align: right;">@item.Precio.ToString("C")</h3>
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Moneda)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Unidad)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Familia)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Tipo)
            </td>
            <td>
                @Html.ActionLink("Detalles", "Details", new { id = @item.IDArticulo, pagina = Model.PageNumber, searchString = @ViewBag.searchString, Familia = ViewBag.Familia }, new { @class = "btn btn-primary btn-xs" })

            </td>

            <td>


                @if (item.Tipo == "Maquina" || item.Tipo == "Mano de obra")
                {
                    <button type="button" name="button" class="btn btn-info btn-xs" onclick=ADDProceso(@item.IDArticulo)>Agregar Proceso</button>

                }
            </td>
        </tr>
    }

</table>

<div class="modal fade" id="ProcesoArticulo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <div id="testeProcesoArticulo"></div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" id="ModalAA" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div id="teste"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" id="ModalEA" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <div id="testee"></div>
            </div>
        </div>
    </div>
</div>




@*Paginación*@
@using (Html.BeginForm("Index", "Articulos", FormMethod.Get, new { id = "pageSizeForm" }))
{
    <div class="pager">
        Página @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) de @Model.PageCount<br />

        @Model.Count de @Model.TotalItemCount elementos


        @Html.PagedListPager(Model, page => Url.Action("Index", new
   {
       page,
       sortOrder = ViewBag.CurrentSort,
       currentFilter = ViewBag.CurrentFilter,
       searchString = ViewBag.CurrentFilter,
       pageSize = ViewBag.psize,
       Familia = ViewBag.Familia
   }))


    </div>
}
@*Paginación*@


<script src="~/Scripts/libs/jquery_1.10.2/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/libs/salert/sweetalert.min.js"></script>

<script>
    function Vermodal() {

        $("#teste").load("/Articulos/AgregaArticulo/", function () {
            $('#ModalAA').modal("show");
        });

    }
</script>


<script>
    function Vermodaleditar(valor) {

        $("#testee").load("/Articulos/EditaArticulo/" + valor, function () {
            $('#ModalEA').modal("show");
        });

    }
</script>

<script>
    function ADDProceso(id) {
        $("#testeProcesoArticulo").load("/Articulos/AgregarProceso/" + id, function () {
            $('#ProcesoArticulo').modal("show");
        });
    }
</script>


<script>
    $('#Familia').on('change', function () {

        @ViewBag.Familia= $(this).text;
    });

</script>

