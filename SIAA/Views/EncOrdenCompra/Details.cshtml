@model SIAAPI.Models.Comercial.EncOrdenCompra

@{
    ViewBag.Title = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3>Detalles Orden de Compra @Model.IDOrdenCompra</h3>

<div>
    <hr />

    <div class="row">
        <div class="columna col-md-4 col-sm-1">
            <dl>
                <dt>
                    @Html.DisplayNameFor(model => model.IDProveedor)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Proveedor.Empresa)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Fecha)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Fecha)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.FechaRequiere)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.FechaRequiere)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Observacion)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Observacion)
                </dd>
                <dt>
                    @Html.DisplayNameFor(model => model.Entregaren)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Entregaren)
                </dd>
                <dt>
                    @Html.DisplayNameFor(model => model.SujetoCalidad)
                </dt>
                <dd>
                    @Html.DisplayFor(model => model.SujetoCalidad)
                </dd>
            
                </dl>
            </div>


            <div class="columna col-md-4 col-sm-1">
                <dl>


                    <dt>
                        @Html.DisplayNameFor(model => model.IDUsoCFDI)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.c_UsoCFDI.Descripcion)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.IDFormapago)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.c_FormaPago.ClaveFormaPago)|@Html.DisplayFor(model => model.c_FormaPago.Descripcion)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.IDMetodoPago)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.c_MetodoPago.ClaveMetodoPago)|@Html.DisplayFor(model => model.c_MetodoPago.Descripcion)
                    </dd>

                    <dt>
                        @Html.DisplayNameFor(model => model.IDMoneda)
                    </dt>

                    <dd>

                        @Html.DisplayFor(model => model.c_Moneda.ClaveMoneda)|@Html.DisplayFor(model => model.c_Moneda.Descripcion)

                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.TipoCambio)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.TipoCambio)
                    </dd>
                    <dt>
                        @Html.DisplayNameFor(model => model.IDCondicionesPago)
                    </dt>

                    <dd>
                        @Html.DisplayFor(model => model.CondicionesPago.ClaveCondicionesPago)|@Html.DisplayFor(model => model.CondicionesPago.Descripcion)
                    </dd>

                </dl>
            </div>
        </div>


    </div>
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>


                    <th>Requisición</th>
                    <th>Clave</th>
                    <th>Artículo</th>
                    @*<th>Presentación</th>*@
                    <th>Nota</th>
                    <th>Compra Mínima</th>
                    <th>Cantidad</th>
                    <th>Recepcionado</th>
                    <th>Precio</th>
                    <th>Importe</th>
                    <th>IVA</th>
                    <th>Total</th>

                </tr>
            </thead>

            @foreach (SIAAPI.ViewModels.Comercial.VDetOrdenCompra item in ViewBag.req)
            {

                SIAAPI.Models.Comercial.ArticuloContext db = new SIAAPI.Models.Comercial.ArticuloContext();
                SIAAPI.Models.Comercial.Caracteristica articuloc = db.Database.SqlQuery<SIAAPI.Models.Comercial.Caracteristica>("select * from Caracteristica where ID=" + item.Caracteristica_ID).ToList().FirstOrDefault();

                SIAAPI.Models.Comercial.Articulo articuloo = db.Articulo.Find(articuloc.Articulo_IDArticulo);
                SIAAPI.Models.Comercial.ClsDatoEntero IDREQUI = db.Database.SqlQuery<SIAAPI.Models.Comercial.ClsDatoEntero>("select iddocumento as Dato from elementosOrdenCompra where iddetdocumento= " + item.IDDetExterna).ToList().FirstOrDefault();
                int IDrequisicion = 0;
                if (IDREQUI != null)
                {
                    IDrequisicion = IDREQUI.Dato;
                }
                if (item.Status.Equals("Cancelado"))
                {
                    <tr class="danger">
                        @if (IDrequisicion != 0)
                        {
                            <td>
                                <div>@IDrequisicion</div>
                                <div>@articuloo.Cref</div>
                            </td>
                        }
                        else
                        {
                            <td>
                                <div>N/A</div>
                                <div>@articuloo.Cref</div>
                            </td>
                        }



                        <td>@item.Articulo</td>
                        @*  <td>@item.Presentacion</td>*@
                        <td>@item.Nota</td>
                        <td>@item.MinimoCompra</td>
                        <td>@item.Cantidad</td>
                        <td>@item.Suministro</td>
                        <td>@string.Format("{0:C}", @item.Costo)</td>
                        <td>@string.Format("{0:C}", @item.Importe)</td>
                        <td>@string.Format("{0:C}", @item.ImporteIva)</td>
                        <td>@string.Format("{0:C}", @item.ImporteTotal)</td>
                    </tr>

                }
                else
                {
                    <tr>
                        @if (IDrequisicion != 0)
                        {
                            <td>
                                <div>@IDrequisicion</div>

                            </td>
                        }
                        else
                        {
                            <td><div>N/A</div></td>



                        }

                        @if (item.Status.Equals("Activo"))
                        {
                            <td><div>@articuloo.Cref</div></td>
                            <td class="success">
                                <div>@item.Articulo</div>
                                <div style="font-size:x-small">@item.Presentacion</div>
                            </td>
                        }
                        else if (item.Status.Equals("Inactivo"))
                        {
                            <td><div>@articuloo.Cref</div></td>
                            <td class="danger">
                                <div>@item.Articulo</div>
                                <div><h5>Número de Presentación @articuloc.IDPresentacion</h5><h6> @item.Presentacion</h6></div>
                            </td>
                        }
                        else if (item.Status.Equals("Recepcionado"))
                        {
                            <td><div>@articuloo.Cref</div></td>
                            <td class="warning">
                                <div>@item.Articulo</div>
                                <div><h5>Número de Presentación @articuloc.IDPresentacion</h5><h6> @item.Presentacion</h6></div>
                            </td>
                        }
                        else if (item.Status.Equals("Finalizado"))
                        {
                            <td><div>@articuloo.Cref</div></td>
                            <td>
                                <div>@item.Articulo</div>
                                <div><h5>Número de Presentación @articuloc.IDPresentacion</h5><h6> @item.Presentacion</h6></div>
                            </td>
                        }


                        <td>@item.Nota</td>
                        @if (item.Cantidad < item.MinimoCompra)
                        {
                            <td class="danger">@item.MinimoCompra</td>
                        }
                        else
                        {
                            <td>@item.MinimoCompra</td>
                        }
                        <td>@Math.Round(item.Cantidad, 2)</td>
                        <td>@item.Suministro</td>
                        <td>@string.Format("{0:C}", @item.Costo)</td>
                        <td>@string.Format("{0:C}", @item.Importe)</td>
                        <td>@string.Format("{0:C}", @item.ImporteIva)</td>
                        <td>@string.Format("{0:C}", @item.ImporteTotal)</td>
                    </tr>
                }
            }

        </table>
    </div>

    <div class="table-responsive">
        <table class="table table-striped">
            <tr>
                <th class="col-lg-1">
                    Moneda Origen
                </th>
                <th class="col-lg-1">
                    Subtotal
                </th>
                <th class="col-lg-1">
                    IVA
                </th>
                <th class="col-lg-1">
                    Total
                </th>
                <th class="col-lg-1">
                    Total en Pesos Mexicanos
                </th>
            </tr>
            @foreach (var itemresumen in ViewBag.sumatoria)
            {

                <tr>
                    <td class="col-lg-1">
                        @itemresumen.MonedaOrigen
                    </td>
                    <td class="col-lg-1">
                        @String.Format("{0:C}", itemresumen.Subtotal)
                    </td>
                    <td class="col-lg-1">
                        @String.Format("{0:C}", itemresumen.IVA)
                    </td>
                    <td class="col-lg-1">
                        @String.Format("{0:C}", itemresumen.Total)
                    </td>
                    <td class="col-lg-1">
                        @String.Format("{0:C}", itemresumen.TotalenPesos)
                    </td>

                </tr>
            }
        </table>
    </div>

    <h5 align="right">Elaboró: @Html.DisplayFor(model => model.User.Username)</h5>
    <p>
        @*@Html.ActionLink("Editar", "Edit", new { id = Model.IDRequisicion }, new { @class = "btn btn-success" }) |*@
        @Html.ActionLink("Regresar a la lista", "Index", null, new { @class = "btn btn-default btn-xs" })
    </p>

