@*@model IEnumerable<SIAAPI.Models.Comercial.EncRequisiones>*@

@*Paginación*@
<script src="~/Scripts/jquery-3.2.1.js" type="text/javascript"></script>

@model PagedList.IPagedList<SIAAPI.Models.Comercial.VHistoriaSuaje>
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
@*Paginación*@

@{
    ViewBag.Title = "HistoriaSuajes";
    Layout = "~/Views/Shared/_Layout.cshtml";

    
}

<h3>Historia de Ordenes de Compras</h3>
<hr />

@*Busqueda*@
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <form class="navbar-form navbar-left">
            <div class="form-group">
                @using (Html.BeginForm())
                {
                    @*<input type="hidden" value="@ViewBag.Clave" id="Clave" name="Clave" />
                    <input type="hidden" value="@ViewBag.Status" id="Status" name="Staus" />
                    <input type="hidden" value="@ViewBag.Fechainicio" id="Fechainicio" name="Fechainicio" />
                    <input type="hidden" value="@ViewBag.Fechafinal" id="Fechafinal" name="Fechafinal" />
                    <input type="hidden" value="@ViewBag.idFamilia" id="IDFamilia" name="IDFamilia" />*@

                    <table>
                        <tr>
                            <td class="col-lg-2">
                                Elementos por página: @Html.DropDownList("pageSize")
                            </td>
                            <td class="col-lg-2">
                                Clave:  <input type="text" name="Clave" id="Clave" placeholder="Introduce el texto a buscar" />
                            </td>
                            @*@Html.TextBox("Clave", ViewBag.CurrentFilter as string, new { @placeholder = " Introduce el texto a buscar:", id = "Clave" })*@
                            <td class="col-lg-2">
                                Familia: @Html.DropDownList("IDFamilia", null, new { id = "IDFamilia" })
                            </td>
                            <td class="col-lg-2">
                                Estatus: @Html.DropDownList("Status", null, new { id = "Status" })
                            </td>
                        </tr>
                    </table>
                    <table>
                        <tr>
                            <td class="col-lg-2">
                                Fecha inicio:<input type="date" name="Fechainicio" id="Fechainicio" />
                            </td>
                            @*@Html.TextBox("Fechainicio", ViewBag.Fechainicio as string, new { type = "date" })*@
                        <td class="col-lg-2">
                            Fecha final:<input type="date" name="Fechafinal" id="Fechafinal" />
                        </td>
                            @*@Html.TextBox("Fechafinal", ViewBag.Fechafinal as string, new { type = "date" })*@
                        </tr>
                        <tr>
                            <td><input type="submit" value="Aplicar" class="btn btn-primary btn-xs" /><span class="sr-only">(current)</span></td>
                            <td><input type="button" id="filtro" name="filtro" value="Generar Excel" onclick="Excel()" class="btn btn-info btn-xs" /><span class="sr-only">(current)</span></td>
                            @*<td><input type="submit" value="Descargar Excel" id="filtro" name="filtro" class="btn btn-info btn-xs" onclick="ExcelHS()" /></td>*@
                        </tr>
                    </table>
                    @*<a class="btn btn-info btn-xs" name="filtro" id="filtro" href="@Url.Action("ExcelHistoriaSuajes")">Exportar a Excel</a>*@
                }

            </div>
        </form>
    </div>
</nav>
<br>
@*Busqueda*@
<div class="table-responsive">
    <table class="table table-striped" width="50">
        <tr>
            <th>

                @Html.Label("Orden Compra")
            </th>
            <th>
                @Html.Label("Fecha")
            </th>
            <th>
                @Html.Label("Fecha requerida")
            </th>
            <th>

                @Html.Label("Descripción")
            </th>
            <th>
                @Html.Label("Cantidad")
            </th>
            <th>
                @Html.Label("Unidad")
            </th>
            <th>
                @Html.Label("Nota")
            </th>

            <th>
                @Html.Label("Subtotal")
            </th>
            <th>
                @Html.Label("Moneda")
            </th>
            <th>
                @Html.Label("Estado")
            </th>



            <th></th>
        </tr>


        @foreach (var item in Model)
        {

            <tr>

                @if (item.Status.Equals("Activo"))
                {
                    <td class="success">
                        @Html.DisplayFor(modelItem => item.Orden_Compra)
                    </td>
                }
                else if (item.Status.Equals("Inactivo") || item.Status.Equals("Cancelado"))
                {
                    <td class="danger">
                        <div> @Html.DisplayFor(modelItem => item.Orden_Compra)</div>

                    </td>
                }
                else if (item.Status.Equals("Recepcionado"))
                {
                    <td class="warning">
                        @Html.DisplayFor(modelItem => item.Orden_Compra)
                    </td>
                }
                else if (item.Status.Equals("Finalizado"))
                {
                    <td>
                        @Html.DisplayFor(modelItem => item.Orden_Compra)
                    </td>
                }

                <td>
                    @Html.DisplayFor(modelItem => item.Fecha)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.FechaRequiere)
                </td>

                @*@Html.DisplayFor(modelItem => item.Empresa)*@
                <td>

                    <div>@Html.DisplayFor(modelItem => item.Cref)</div>
                    <div>
                        NP: @Html.DisplayFor(modelItem => item.IDPresentacion)
                        @Html.DisplayFor(modelItem => item.Presentacion)
                    </div>
                </td>

                <td>
                    @Html.DisplayFor(modelItem => item.Cantidad)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Nombre)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Nota)
                </td>
                <td align="right">
                    @String.Format("{0:C}", item.Monto)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.ClaveMoneda)
                </td>
                <td>
                    @{
                        string estado = "";
                        if (item.Status == "Activo")
                        {
                            estado = "Por Recepcionar";
                        }
                        if (item.Status == "Finalizado")
                        {
                            estado = "Recepcionada";
                        }
                        if (item.Status == "Inactivo")
                        {
                            estado = "Inactivo";
                        }
                        if (item.Status == "Cancelado")
                        {
                            estado = "Cancelada";
                        }
                    }
                    @Html.DisplayFor(modelItem => estado)
                </td>
                <td></td>




            </tr>
            @*<tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        NP: @Html.DisplayFor(modelItem => item.IDPresentacion)
                        @Html.DisplayFor(modelItem => item.Presentacion)
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>*@

        }


    </table>
</div>

<br />
@*Paginación*@
@using (Html.BeginForm("HistoriaSuajes", "EncOrdenCompra", FormMethod.Get, new { id = "pageSizeForm" }))
{
    <div class="pager">
        Página @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) de @Model.PageCount<br />

        @Model.Count de @Model.TotalItemCount elementos

        @Html.PagedListPager(Model, page => Url.Action("HistoriaSuajes", new
   {
       page,

       currentFilter = ViewBag.CurrentFilter,
       Clave = ViewBag.CurrentFilter,
       Status = ViewBag.StatusSeleccionado,
       IDFamilia = ViewBag.FamiliaSeleccionada,
       pageSize = ViewBag.psize,


   }))

    </div>
}
@*Paginación*@

<script src="~/Scripts/libs/salert/sweetalert.min.js"></script>

<script>
    function ExcelHS(id) {
        var Clave = $("input[id$=Clave]").text();
        var Status = $('[id$=Status] option:selected').val();
        var Fechainicio = $("input[id$=Fechainicio]").val();
        var Fechafinal = $("input[id$=Fechafinal]").val();
        var IDFamilia = $("input[id$=IDFamilia] option:selected").val();

        var cont = "?Clave=" + Clave + "&Status=" + Status + " &Fechainicio=" + Fechainicio + " &FechaFinal=" + Fechafinal + " &IDFamilia=" + IDFamilia;
        var urlagre = '@Url.Action("ExcelHistoriaSuajes", "EncOrdenCompra")';
        $.get(urlagre, { cont}, function (response) {
                if (response) {
                    location.reload();
                    row.change;

                }
            }).fail(function (response) {
                // display error message?
            });
    }

 
     function Excel(id) {
        var urledit = '@Url.Action("ExcelHistoriaSuajes", "EncOrdenCompra")';

         var Clave = $("input[id$=Clave]").val();
         var Status = $('[id$=Status] option:selected').text();
         var Fechainicio = $("input[id$=Fechainicio]").val();
         var Fechafinal = $("input[id$=Fechafinal]").val();
         var IDFamilia = $("[id$=IDFamilia] option:selected").val();
        

         var urledit = urledit + "?Clave=" + Clave + "&Status=" + Status + " &Fechainicio=" + Fechainicio + " &FechaFinal=" + Fechafinal + " &IDFamilia=" + IDFamilia
        window.location.href = urledit



    }


</script>