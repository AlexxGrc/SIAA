

@{
    ViewBag.Title = "CambiarMoneda";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<h3>Cambiar moneda en Prefactura</h3>


@using (Html.BeginForm())
{

    <div class="form-horizontal">
        <hr />
        <br>
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <input type="hidden" name="id" id="id" class="form-control" value="@ViewBag.id"/>
        <div class="row">
            <div class="col col-md-4 col-sm-1">
                <div class="form-group">
                    @Html.Label("Moneda Origen", htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-8">
                        @Html.DropDownList("IDMoneda", null, htmlAttributes: new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="col col-md-4 col-sm-1">
                <div class="form-group">
                    @Html.Label("Moneda Destino",  htmlAttributes: new { @class = "control-label col-md-2" })

                    <div class="col-md-8">
                        @Html.DropDownList("IDMonedaD",null, "--Selecciona una Moneda--", htmlAttributes: new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="col col-md-4 col-sm-1">
                <div class="form-group">
                    @Html.Label("TC", htmlAttributes: new { @class = "control-label col-md-2" })
                    <div class="col-md-8">
                        <input type="text" name="TC" id="TC" class="form-control" />
                    </div>
                </div>

            </div>

        </div>

        <br><br>


        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>


                        <th>Artículo</th>
                        <th>Presentación</th>
                        <th>Nota</th>
                        @*<th>Compra Mínima</th>*@
                        <th>Cantidad</th>
                        @*<th>Devolución</th>*@
                        <th>Precio</th>
                        <th>Importe</th>
                        <th>IVA</th>
                        <th>Total</th>

                    </tr>
                </thead>

                @foreach (var item in ViewBag.req)
                {
                    if (item.Status.Equals("Cancelado"))
                    {
                        <tr class="danger">


                            <td>@item.Articulo</td>
                            <td>@item.Presentacion</td>
                            <td>@item.Nota</td>
                            @*<td>@item.MinimoVenta</td>*@
                            <td>@item.Cantidad</td>
                            <td>@string.Format("{0:C}", @item.Costo)</td>
                            <td>@string.Format("{0:C}", @item.Importe)</td>
                            <td>@string.Format("{0:C}", @item.ImporteIva)</td>
                            <td>@string.Format("{0:C}", @item.ImporteTotal)</td>
                        </tr>
                    }
                    else
                    {

                        <tr>
                            @if (item.Status.Equals("Devuelto"))
                            {
                                <td class="warning">
                                    @item.Articulo
                                </td>
                            }
                            else if (item.Status.Equals("Activo"))
                            {
                                <td class="success">
                                    @item.Articulo
                                </td>
                            }
                            else if (item.Status.Equals("Finalizado"))
                            {
                                <td>
                                    @item.Articulo
                                </td>
                            }

                            <td>@item.Presentacion</td>
                            <td>@item.Nota</td>
                            @*<td>@item.MinimoVenta</td>*@
                            <td>@item.Cantidad</td>
                            @*<td>@item.Devolucion</td>*@
                            <td>@string.Format("{0:C}", @item.Costo)</td>
                            <td>@string.Format("{0:C}", @item.Importe)</td>
                            <td>@string.Format("{0:C}", @item.ImporteIva)</td>
                            <td>@string.Format("{0:C}", @item.ImporteTotal)</td>
                        </tr>
                    }
                }
            </table>
        </div>

        <div class="table-responsive">
            <table class="table table-striped">
                <tr>
                    <th class="col-lg-1">
                        Moneda Origen
                    </th>
                    <th class="col-lg-1">
                        Subtotal
                    </th>
                    <th class="col-lg-1">
                        IVA
                    </th>
                    <th class="col-lg-1">
                        Total
                    </th>
                    <th class="col-lg-1">
                        Total en Pesos Mexicanos
                    </th>
                </tr>
                @foreach (var itemresumen in ViewBag.sumatoria)
                {

                    <tr>
                        <td class="col-lg-1">
                            @itemresumen.MonedaOrigen
                        </td>
                        <td class="col-lg-1">
                            @String.Format("{0:C}", itemresumen.Subtotal)
                        </td>
                        <td class="col-lg-1">
                            @String.Format("{0:C}", itemresumen.IVA)
                        </td>
                        <td class="col-lg-1">
                            @String.Format("{0:C}", itemresumen.Total)
                        </td>
                        <td class="col-lg-1">
                            @String.Format("{0:C}", itemresumen.TotalenPesos)
                        </td>

                    </tr>
                }
            </table>
        </div>


        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Grabar" class="btn btn-success btn-xs" />|@Html.ActionLink("Regresar a la lista", "Index", null, new { @class = "btn btn-default btn-xs" })
            </div>
        </div>
    </div>

}
@if(ViewBag.mensaje != null){
<h3 class="text-danger">@ViewBag.mensaje</h3>
}

        <script src="~/Scripts/libs/jquery_1.10.2/jquery-1.10.2.min.js"></script>
        <script type="text/javascript">


            $(document).ready(function () {

                $("#IDMonedaD").change(function () {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("getTC")',
                        dataType: 'json',
                        data: { idmonedao: $("#IDMoneda").val(), idmonedad: $("#IDMonedaD").val() },
                        success: function (metodos) {
                            $("#TC").val(metodos)

                        },
                        error: function (ex) {
                            alert('Failed to retrieve.' + ex);
                        }
                    });
                    return false;
                })
            });

        </script>

 