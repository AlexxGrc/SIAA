@model SIAAPI.Models.Cfdi.FolioVentas

@{
    ViewBag.Title = "PrefacturaPedido";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<head runat="server">
    <script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.js" type="text/javascript"></script>
    <script src="~/Scripts/libs/jquery_1.10.2/jquery-1.10.2.min.js"></script>
    <script type="text/javascript">
     //Consecutivo de campos a agregar
         campoNuevo = 0;
        //Funcion de agregar campos
        function AgregarCampos() {
            campoNuevo = campoNuevo + 1;
            campo = '<div class="col-md-8"><li><label>UUID Anticipo ' + campoNuevo + ':</label><input type="text" size="20" class="form-control" name="campo' + campoNuevo + '"  /></li></div>';
            $("#campos").append(campo);


        }
        //Pasar los valores txt por QueryString
        //function EnviarDatos() {
        //    var query = "";
        //    $('input[type=text][name!=""]').each(function (index, domEle) {

        //        query = query + ","+ $(domEle).val();

        //    });
        // // $('#datos').val($(query));
        //  // window.location.href = "/EncPrefactura/PrefacturaRemision" + query;

        //}
    </script>
</head>
<h3>Prefactura Pedido</h3>

@using (Html.BeginForm())
{

    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

        <div class="form-group">
            @Html.LabelFor(model => model.IDFolioVentas, "Serie", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                @Html.DropDownList("IDFolioVentas", null, htmlAttributes: new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.IDFolioVentas, "", new { @class = "text-danger" })
            </div>
        </div>
        <div class="form-group">
            @Html.Label("Tipo de Relacion", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                @Html.DropDownList("IDTipoRelacion", null, htmlAttributes: new { @class = "form-control" })
            </div>
        </div>
        <div class="form-group">
            @Html.Label("Uso CFDI", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                @Html.DropDownList("IDUsoCFDI", null, htmlAttributes: new { @class = "form-control" })
            </div>
        </div>


        <div class="form-group">
            @Html.Label("Condición de Pago", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                @Html.DropDownList("IDCondicionesPago", null, htmlAttributes: new { @class = "form-control" })
            </div>
        </div>
        <div class="form-group">
            @Html.Label("Método de pago", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                @Html.DropDownList("IDMetodoPago", null, htmlAttributes: new { @class = "form-control" })
            </div>
        </div>


        <div class="form-group">
            @Html.Label("Forma de pago", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                @Html.DropDownList("IDFormapago", null, htmlAttributes: new { @class = "form-control" })
            </div>
        </div>



        <div class="form-group">
            @Html.Label("Observación", htmlAttributes: new { @class = "control-label col-md-2" })
            <div class="col-md-8">
                <input type="text" name="Observacion" class="form-control" />
            </div>
        </div>



        <form id="form1" runat="server">
            <div>

                <a href="#" class="btn btn-warning btn-xs" onclick="AgregarCampos();">Agregar Documentos Relacionados</a>
                @*<a href="#" onclick="EnviarDatos();">EnviarDatos</a>*@
                <div id="campos">
                </div>
            </div>
        </form>




        <ul>
            <TABLE id="latabla" class="table">
                <thead>
                    <tr>
                        <th>Cantidad</th>
                        <th> Articulo</th>
                        <th> Precio</th>
                        <th> Importe</th>
                        @*<th> Lote</th>*@
                        <th></th>
                    </tr>
                </thead>
                <tbody>

                    @{int contador = 1;
                        decimal acuimporte = 0;
                        foreach (SIAAPI.Models.Comercial.DetPedido partida in ViewData["detpedido"] as IList<SIAAPI.Models.Comercial.DetPedido>)
                        {
                            string cadena = "cantidad" + contador;
                            string lote = "lote" + contador;
                            string precio = "precio" + contador;
                            string importe = "importe" + contador;

                            decimal importeN = @Math.Round((partida.Costo * partida.Cantidad), 2);
                            acuimporte += importeN;
                            <tr>
                                @{SIAAPI.Models.Comercial.Articulo articulo = new SIAAPI.Models.Comercial.ArticuloContext().Articulo.Find(partida.IDArticulo);
                                }
                                <td>
                                   @* <input type="text" id="@cadena" value="@partida.Cantidad">*@
                                    <label id="@cadena"> @partida.Cantidad</label>
                                </td>
                                <td>
                                    @articulo.Cref 

                                </td>
                                <td>
                                    @articulo.Descripcion

                                </td>
                                <td>
                                    <label id="@precio">@Math.Round(partida.Costo, 2)</label>
                                </td>
                                <td>
                                    <label id="@importe">@importeN </label>
                                </td>
                                @*<td>
                                    <input type="text" id="@lote" value="">
                                </td>*@
                              
                            </tr>
                                        contador++;
                                    }
                    }
                    @{decimal iva = Math.Round(acuimporte * 0.16M, 2);
                        decimal total = acuimporte + iva;
                    }
                    <tr>
                        <th></th>
                        <th> </th>
                        <th> </th>
                        @*<th> </th>*@
                        <th> Subtotal</th>
                        <th><label id="Subtotal">@acuimporte</label> </th>
                    </tr>
                    <tr>
                        <th></th>
                        <th> </th>
                        @*<th> </th>*@
                        <th> </th>
                        <th> IVA</th>
                        <th><label id="Subtotal">@iva</label> </th>
                    </tr>
                    <tr>
                        <th></th>
                        <th> </th>
                        @*<th> </th>*@
                        <th> </th>
                        <th>Total </th>
                        <th><label id="Subtotal">@total</label> </th>
                    </tr>
                    <tr></tr>
                    <tr><td>Numero de elementos <label id="contador">@(contador-1)</label></td></tr>
                </tbody>
            </TABLE>
        </ul>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Grabar" class="btn btn-success btn-xs" />|@Html.ActionLink("Regresar a la lista", "Index", null, new { @class = "btn btn-default btn-xs" })
            </div>
        </div>
    </div>

}



